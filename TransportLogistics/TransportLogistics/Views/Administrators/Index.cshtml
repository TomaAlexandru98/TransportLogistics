@using Microsoft.AspNetCore.Identity;
@model IEnumerable<IdentityUser>
@inject UserManager<IdentityUser> userManager;
@{
    ViewData["Title"] = "AdministratorController";
}
<link rel="stylesheet" type="text/css" href="~/lib/datatables/datatables.min.css" />
<link rel="stylesheet" type="text/css" href="~/lib/datatables/Responsive-2.2.3/css/responsive.bootstrap4.css" />
<link rel="stylesheet" type="text/css" href="~/lib/datatables/Responsive-2.2.3/css/responsive.dataTables.min.css" />

@section Scripts {
    <script type="text/javascript" src="~/lib/datatables/datatables.min.js"></script>
    <script type="text/javascript" src="~/lib/datatables/Responsive-2.2.3/js/dataTables.responsive.min.js"></script>
    <partial name="_ValidationScriptsPartial" />
}

    <div id="usersAccounts">
        <partial name="_TablePartial.cshtml" model="@Model" />
    </div>
    <form id="deleteForm">
        <div class="modal fade" tabindex="-1" id="removeModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Delete User</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div id="newPaymentBody" class="modal-body">
                        <p>Are you sure you want to delete this user?</p>
                        <input type="hidden" name="UserId" id="userToDeleteId" />
                       
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                        <button id="buttonSubmit" type="submit" onclick="GetUsersPartialFromDelete()" data-dismiss="modal" class="btn btn-primary">Yes</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <form id="editForm">
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"Edit>Edit User</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" id="editModal">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" id="editButton" class="btn btn-primary" data-dismiss="modal" onclick="GetUsersPartialFromEdit()">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <form id="createForm">

        <div class="modal fade" tabindex="-1" id="Modal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Create New User</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div id="newPaymentBody" class="modal-body">
                        @await Html.PartialAsync("_NewUserPartial", new TransportLogistics.ViewModels.UserAccountCreateViewModel { })
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" data-dismiss="modal" onclick="GetUsersPartialFromCreate()">Add User</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
  
 <script>
        function LoadEditModal(userId) {
            loadServerPartialView('#editModal', 'Administrators/EditUserAccount?userId=' + userId)
        }
        function GetUsersPartialFromEdit() {
            var formData = $('#editForm').serialize();
            $.ajax({
                type: "POST",
                data: formData,
                url: "/Administrators/EditUserAccount",
                success: function () {
                    loadServerPartialView('#usersAccounts', "/Administrators/GetUsersPartialView");

                }
            });
     }
     function GetUsersPartialFromCreate() {
         var formData = $('#createForm').serialize();
         $.ajax({
             type: "POST",
             data: formData,
             url: "/Administrators/CreateUserAccount",
             success: function () {
                  loadServerPartialView('#usersAccounts', "/Administrators/GetUsersPartialView");
             }
         });
     }
     function GetUsersPartialFromDelete() {
         var UserId = document.getElementById("userToDeleteId").value;
         loadServerPartialView('#usersAccounts', "/Administrators/DeleteUserAccount?UserId=" + UserId);
           
     }
    
</script>
